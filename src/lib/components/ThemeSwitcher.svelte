<script lang="ts">
  import { fly } from "svelte/transition";
  import { BASE_DURATION } from "$lib/transitions";
  import { bounceOut } from "svelte/easing";
  import { onMount } from "svelte";

  enum Theme {
    dark = "dark",
    light = "light",
  }

  function toggleTheme(theme: string) {
    if (typeof document !== "undefined") {
      if (theme === Theme.dark) {
        document.documentElement.setAttribute('data-theme', 'dark');
        // document.body.classList.remove("light-mode");
        // document.body.classList.add("dark-mode");
        window.localStorage.setItem("theme", "dark");
      } else {
        document.documentElement.setAttribute('data-theme', 'light');
        // document.body.classList.remove("dark-mode");
        // document.body.classList.add("light-mode");
        window.localStorage.setItem("theme", "light");
      }
    }
  }

  function performSlide(slideRight: boolean) {
    if (typeof document !== "undefined") {
      const slider = document.getElementById("slider");
      if (slider) {
        if (slideRight) {
          slider.classList.remove("self-start");
          slider.classList.add("self-end");
        } else {
          slider.classList.remove("self-end");
          slider.classList.add("self-start");
        }
      }
    }
  }

  let currentTheme: string = Theme.dark;
  let slideRight: boolean = false;

  // Check if theme has been saved in localStorage
  if (typeof window !== "undefined") {
    currentTheme = window.localStorage.getItem("theme") ?? Theme.dark;
  }

  onMount(() => {
    if (currentTheme === Theme.light) {
      slideRight = true;
    }
  });

  $: toggleTheme(currentTheme);
  $: performSlide(slideRight);
</script>

<button
  on:click={() => {
    currentTheme = currentTheme === Theme.dark ? Theme.light : Theme.dark;
    slideRight = !slideRight;
  }}
  class="flex flex-col justify-center px-1 w-[48px] z-0 rounded-2xl outline outline-[1.5px] hover:outline-PrimaryText highlight outline-[#8f8e8e]"
>
  <span id="slider" class="self-start">
    {#if currentTheme === Theme.dark}
      <div
        in:fly={{ x: 30 }}
        class=" bg-[#515050b3] rounded-full z-50 -translate-x-[4.5px] p-[6px]"
      >
        <svg
          class="sun-moon-toggle moon"
          width="13"
          height="13"
          viewBox="0 0 22 22"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            class=" fill-primaryText"
            d="M19.5287 13.9304C19.3687 13.6604 18.9187 13.2404 17.7987 13.4404C17.1787 13.5504 16.5487 13.6004 15.9187 13.5704C14.7951 13.5194 13.6931 13.2436 12.678 12.7592C11.6629 12.2748 10.7552 11.5917 10.0087 10.7504C8.70873 9.30036 7.90873 7.41036 7.89873 5.37036C7.89873 4.23036 8.11873 3.13036 8.56873 2.09036C9.00873 1.08036 8.69873 0.550361 8.47873 0.330361C8.24873 0.100361 7.70873 -0.219639 6.64873 0.220361C2.55873 1.94036 0.0287316 6.04036 0.328732 10.4304C0.628732 14.5604 3.52873 18.0904 7.36873 19.4204C8.29968 19.7452 9.27355 19.9305 10.2587 19.9704C10.4187 19.9804 10.5787 19.9904 10.7387 19.9904C14.0887 19.9904 17.2287 18.4104 19.2087 15.7204C19.8787 14.7904 19.6987 14.2004 19.5287 13.9304Z"
          />
        </svg>
      </div>
    {:else}
      <div
        in:fly={{ x: -30 }}
        class="bg-[#fde34d] translate-x-[4.5px] rounded-full z-20 p-[6px]"
      >
        <svg
          width="13"
          height="13"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M12.7412 0.5C13.0822 0.5 13.4092 0.635459 13.6503 0.876577C13.8915 1.1177 14.0269 1.44472 14.0269 1.78571V3.5C14.0269 3.84099 13.8915 4.16802 13.6503 4.40914C13.4092 4.65026 13.0822 4.78571 12.7412 4.78571C12.4002 4.78571 12.0732 4.65026 11.8321 4.40914C11.591 4.16802 11.4555 3.84099 11.4555 3.5V1.78571C11.4555 1.44472 11.591 1.1177 11.8321 0.876577C12.0732 0.635459 12.4002 0.5 12.7412 0.5ZM16.5984 12.5C16.5984 13.0065 16.4986 13.5081 16.3047 13.9761C16.1109 14.444 15.8268 14.8692 15.4686 15.2274C15.1105 15.5856 14.6852 15.8697 14.2173 16.0635C13.7493 16.2574 13.2477 16.3571 12.7412 16.3571C12.2347 16.3571 11.7331 16.2574 11.2651 16.0635C10.7972 15.8697 10.372 15.5856 10.0138 15.2274C9.65563 14.8692 9.37151 14.444 9.17768 13.9761C8.98384 13.5081 8.88407 13.0065 8.88407 12.5C8.88407 11.477 9.29044 10.4959 10.0138 9.77259C10.7372 9.04923 11.7182 8.64286 12.7412 8.64286C13.7642 8.64286 14.7453 9.04923 15.4686 9.77259C16.192 10.4959 16.5984 11.477 16.5984 12.5ZM14.0269 21.5C14.0269 21.159 13.8915 20.832 13.6503 20.5909C13.4092 20.3497 13.0822 20.2143 12.7412 20.2143C12.4002 20.2143 12.0732 20.3497 11.8321 20.5909C11.591 20.832 11.4555 21.159 11.4555 21.5V23.2143C11.4555 23.5553 11.591 23.8823 11.8321 24.1234C12.0732 24.3645 12.4002 24.5 12.7412 24.5C13.0822 24.5 13.4092 24.3645 13.6503 24.1234C13.8915 23.8823 14.0269 23.5553 14.0269 23.2143V21.5ZM20.4555 12.5C20.4555 12.159 20.591 11.832 20.8321 11.5909C21.0732 11.3497 21.4002 11.2143 21.7412 11.2143H23.4555C23.7965 11.2143 24.1235 11.3497 24.3646 11.5909C24.6058 11.832 24.7412 12.159 24.7412 12.5C24.7412 12.841 24.6058 13.168 24.3646 13.4091C24.1235 13.6503 23.7965 13.7857 23.4555 13.7857H21.7412C21.4002 13.7857 21.0732 13.6503 20.8321 13.4091C20.591 13.168 20.4555 12.841 20.4555 12.5ZM2.02693 11.2143C1.68593 11.2143 1.35891 11.3497 1.11779 11.5909C0.87667 11.832 0.741211 12.159 0.741211 12.5C0.741211 12.841 0.87667 13.168 1.11779 13.4091C1.35891 13.6503 1.68593 13.7857 2.02693 13.7857H3.74121C4.0822 13.7857 4.40923 13.6503 4.65035 13.4091C4.89147 13.168 5.02693 12.841 5.02693 12.5C5.02693 12.159 4.89147 11.832 4.65035 11.5909C4.40923 11.3497 4.0822 11.2143 3.74121 11.2143H2.02693ZM4.2555 4.01429C4.49657 3.77351 4.82335 3.63827 5.16407 3.63827C5.50478 3.63827 5.83157 3.77351 6.07264 4.01429L7.55035 5.48857C7.792 5.72999 7.92785 6.05752 7.92801 6.39911C7.92817 6.74069 7.79263 7.06835 7.55121 7.31C7.43167 7.42965 7.28973 7.52459 7.1335 7.58939C6.97727 7.65419 6.80981 7.68758 6.64067 7.68766C6.29909 7.68782 5.97143 7.55228 5.72978 7.31086L4.2555 5.83486C4.01472 5.59379 3.87949 5.267 3.87949 4.92629C3.87949 4.58557 4.01472 4.25879 4.2555 4.01771V4.01429ZM19.7526 17.6909C19.6333 17.5713 19.4916 17.4764 19.3357 17.4117C19.1797 17.3469 19.0125 17.3135 18.8436 17.3133C18.6747 17.3131 18.5074 17.3463 18.3513 17.4107C18.1952 17.4752 18.0533 17.5698 17.9338 17.6891C17.8142 17.8085 17.7194 17.9501 17.6546 18.1061C17.5898 18.2621 17.5564 18.4293 17.5562 18.5982C17.5561 18.7671 17.5892 18.9344 17.6537 19.0905C17.7182 19.2466 17.8128 19.3885 17.9321 19.508L19.4081 20.9857C19.6507 21.2198 19.9755 21.3492 20.3126 21.3462C20.6497 21.3431 20.9721 21.2077 21.2104 20.9692C21.4487 20.7307 21.5837 20.4082 21.5865 20.0711C21.5893 19.7339 21.4595 19.4092 21.2252 19.1669L19.7509 17.6926L19.7526 17.6909ZM21.2269 4.01429C21.4677 4.25536 21.6029 4.58214 21.6029 4.92286C21.6029 5.26357 21.4677 5.59036 21.2269 5.83143L19.7526 7.30914C19.6332 7.42868 19.4914 7.52353 19.3353 7.58827C19.1792 7.65301 19.0119 7.68637 18.843 7.68645C18.674 7.68653 18.5066 7.65332 18.3505 7.58873C18.1944 7.52414 18.0525 7.42943 17.9329 7.31C17.8134 7.19057 17.7185 7.04877 17.6538 6.89269C17.5891 6.7366 17.5557 6.5693 17.5556 6.40032C17.5555 6.05906 17.6909 5.73171 17.9321 5.49029L19.4081 4.016C19.6491 3.77523 19.9759 3.63999 20.3166 3.63999C20.6574 3.63999 20.9841 3.77523 21.2252 4.016L21.2269 4.01429ZM7.55035 19.5114C7.6731 19.3928 7.77098 19.2508 7.83828 19.094C7.90559 18.9371 7.94098 18.7683 7.94238 18.5976C7.94378 18.4269 7.91117 18.2576 7.84645 18.0996C7.78173 17.9417 7.6862 17.7982 7.56542 17.6775C7.44464 17.5568 7.30105 17.4614 7.14301 17.3969C6.98497 17.3323 6.81565 17.2998 6.64494 17.3014C6.47422 17.303 6.30553 17.3385 6.1487 17.406C5.99187 17.4734 5.85004 17.5714 5.7315 17.6943L4.25721 19.1686C4.0301 19.4123 3.90646 19.7347 3.91234 20.0678C3.91822 20.4008 4.05315 20.7186 4.28872 20.9542C4.52428 21.1898 4.84208 21.3247 5.17517 21.3306C5.50826 21.3365 5.83063 21.2128 6.07435 20.9857L7.55035 19.5114Z"
            class=" fill-primaryText"
          />
        </svg>
      </div>
    {/if}
  </span>
</button>

<style>
  /* Sun moon icon transition */
  .sun-moon-toggle {
    cursor: pointer;
    transition: transform 0.5s ease;
  }

  /* .sun-moon-toggle:hover {
    transform: scale(1.1);
  } */

  .sun-moon-toggle path {
    transition: fill 0.5s ease;
  }

  .highlight {
    transition: outline-color 0.5s ease;
  }
</style>
